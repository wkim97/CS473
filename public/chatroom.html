<!DOCTYPE html>


<html>
<head>

	<meta charset="utf-8" />
  <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"> -->
  	<title>chatroom</title>

  	<link rel = "stylesheet" type="text/css" href = "https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">


  	<!--- Example CSS -->
  	<style>

  		.container1{
  			max-width:1170px;
  			margin: auto;
  			height: 65%;
  		}

			.container2{
  			max-width:1170px;
  			margin: auto;
  		}

  		img{
  			max-width:100%;
  		}

  		.mesgs {
  			clear: both;
  			overflow: hidden;
  			text-align: left;
  			float: left;
  			width: 100%;
        /* margin: 0 0 10px; */
				height: 87%;

  		}

			.msg_history {
  			height: 100%;
  			overflow-y: auto;
  		}

  		.msg_history_border{
  			border: 1px solid #c4c4c4;
  			padding: 0px 5px 0px 0px;
				height: 100%
  		}



  		.incoming_msg_img {
  			display: inline-block;
  			width: 6%;
  		}
  		.incoming_msg {
  			overflow: hidden;
  			margin:25px 0 25px 20px;
  		}

  		.received_msg {
  			display: inline-block;
  			padding: 0 0 0 10px;
  			vertical-align: top;
  			width: auto;
  		}
  		.received_msg p {
  			background: #ebebeb none repeat scroll 0 0;
  			border-radius: 3px;
  			color: #646464;
  			font-size: 14px;
  			margin: 0;
  			padding: 5px 10px 5px 12px;
  			width: 100%;
  		}
  		.time_date {
  			color: #747474;
  			display: block;
  			font-size: 12px;
  			margin: 8px 0 0;
  		}
  		.received_withd_msg {
  			width: 40%;
  		}

  		.outgoing_msg {
  			overflow:hidden;
  			margin:25px 25px 25px;
  		}

  		.sent_msg {
  			text-align: right;
  			float: right;
  			width: auto;
  		}
  		.sent_msg p {
  			background: #000000 none repeat scroll 0 0;
  			border-radius: 3px;
  			font-size: 14px;
  			margin: 0;
  			color:#fff;
  			padding: 5px 10px 5px 12px;
  			width:100%;
  		}

  		.input_msg_write input {
  			background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
  			border: 1px solid #c4c4c4;
  			color: #4c4c4c;
  			font-size: 15px;
  			min-height: 48px;
  			width: 100%;
  		}

  		.type_msg {
  			border-top: 1px solid #c4c4c4;
  			position: relative;
  		}
  		.msg_send_btn {
  			background: #000000 none repeat scroll 0 0;
  			border: medium none;
  			border-radius: 50%;
  			color: #fff;
  			cursor: pointer;
  			font-size: 17px;
  			height: 33px;
  			position: absolute;
  			right: 0;
  			top: 11px;
  			width: 33px;
  		}

  		.messaging { padding: 0 0 50px 0;}

			ul.three.tabs{
				width: 100%;
				display: flex;
				flex-flow: row wrap;
				justify-content: space-between;
			}
  		ul.tabs{
  			margin: 0px;
  			padding: 0px;
  			list-style: none;
  			width: 100%;
				text-align: center;
  		}
  		ul.tabs li{
  			background: #e0e1e2;
  			color: #222;
  			display: inline-block;
  			padding: 10px 15px;
  			cursor: pointer;
  		}

  		ul.tabs li.current{
  			background: #f2f2f2;
  			color: #222;
  		}
  		ul.tabs li.tab-link.current{
  			width: calc(100%/3);
  			align: center;
				padding: auto;
				border-top: 1px solid #c4c4c4;
				border-right: 1px solid #c4c4c4;
				border-left: 1px solid #c4c4c4;
				border-top-left-radius: 5px;
				border-top-right-radius: 5px;

  		}
  		ul.tabs li.tab-link{
  			width: calc(100%/3);
  			align: center;
				padding: auto;
				border-top: 1px solid #c4c4c4;
				border-right: 1px solid #c4c4c4;
				border-left: 1px solid #c4c4c4;
				border-top-left-radius: 5px;
				border-top-right-radius: 5px;

  		}

  		.tab-content{
  			overflow: auto;
  			display: none;
				height: 110px;
  			background: #f8f3e8;
  			padding: 10px 0 10px;
				margin: auto;
				border-right: 1px solid #c4c4c4;
				border-left: 1px solid #c4c4c4;
				border-bottom: 1px solid #c4c4c4;
				border-bottom-left-radius: 5px;
				border-bottom-right-radius: 5px;
  		}

  		.tab-content.current{
  			overflow: auto;
  			display: inherit;
  			height: 110px;
				background: #f2f2f2;
				padding: 10px 0 10px;
				margin: auto;
				border-right: 1px solid #c4c4c4;
				border-left: 1px solid #c4c4c4;
				border-bottom: 1px solid #c4c4c4;
				border-bottom-left-radius: 5px;
				border-bottom-right-radius: 5px;
				display: flex;
				flex-flow: row wrap;
				justify-content: space-around;
				align-content: space-between;
  		}

			.preferences{
				/* border: 1px solid #c4c4c4;
				border-radius: 5px; */
				background-color: #f8f3e8;
			}

			body {
					background-color: #f8f3e8;
					font-family: Arial, Helvetica, sans-serif;
			}

  	</style>
  	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>

  	<!--- Example Javascript -->
  	<script>
  		$('.ui .item').on('click', function() {
  			$('.ui .item').removeClass('active');
  			$(this).addClass('active');
  		});
  	</script>
  </head>
  <body>

  	<body>

  		<div class="container1">

        <button class="ui basic icon button" onclick="goBack();">
          <i class="angle left icon"></i>
        </button>
        <h3 class="text-center" style="display: inline-block; margin:15px 0 15px;"> </h3>

  			<div class="mesgs">
  				<div class="msg_history_border">
  					<div class="msg_history">

  						<!-- <div class="incoming_msg">
  							<div class="incoming_msg_img"> <img src="../images/chani.jpg" alt="sunil"> </div>
  							<div class="received_msg">
  								<p>Test, incoming</p>
  								<span class="time_date"> 11:01 AM    |    Yesterday</span>
  							</div>
  						</div>

  						<div class="outgoing_msg">
  							<div class="sent_msg">
  								<p>Test, outgoing</p>
  								<span class="time_date"> 11:01 AM    |    June 9</span> </div>
  							</div> -->

  									</div>
  								</div>
  							</div>
							</div>

                <div class="container2">
									<div class="ui fluid input" style="padding: 0 0 6px;">
                    <input id="type_here" value ="" type="text" style="margin: 0 3px 0 0;">
										<div class="ui button" onclick="untype_pref();" style="margin: 0 3px 0 0;">
											Delete
											<!-- <i class="window close icon"></i> -->
										</div>
                    <div class="ui button" onclick="send_message();" style="margin: 0 0 0 0;">
											Send
											<!-- <i class="reply icon"></i> -->
										</div>
                  </div>

									<div class="emojis" style="background-color: #f2f2f2;">
                    <div class="ui basic six buttons" style="padding: 0 0 0px;">
                      <button class="ui button" id="Good" onclick="type_pref(this.id);">
                        Good
                      </button>
                      <button class="ui button" id="Bad" onclick="type_pref(this.id);">
                        Bad
                      </button>
                      <button class="ui button" id="Yes" onclick="type_pref(this.id);">
                        Yes
                      </button>
                      <button class="ui button" id="No" onclick="type_pref(this.id);">
                        No
                      </button>
                      <button class="ui button" id="?" onclick="type_pref(this.id);">
                        ?
                      </button>
                      <button class="ui button" id="." onclick="type_pref(this.id);">
                        .
                      </button>
                    </div>
                  </div>

                  <div class="preferences">
                    <ul class="three tabs">
                      <li class="tab-link current" data-tab="tab-1" style="align: center;">
                        <i class="globe icon"></i>
                      </li>
                      <li class="tab-link" data-tab="tab-2" style="align: center;">
                        <i class="utensils icon"></i>
                      </li>
                      <li class="tab-link" data-tab="tab-3" style="align: center;">
                        <i class="clock icon"></i>
                      </li>
                    </ul>
                    <div id="tab-1" class="tab-content current" style="align-content: space-between;">
                      <div id="Korean" value="Korean" class="ui button" style="width: 30%; margin: 2px 0 2px;" onclick="type_pref(this.id);">Korean</div>
                      <div id="Japanese" class="ui button" style="width: 30%; margin: 2px 0 2px" onclick="type_pref(this.id)">Japanese</div>
                      <div id="Chinese" class="ui button" style="width: 30%; margin: 2px 0 2px" onclick="type_pref(this.id)">Chinese</div>
                      <div id="Thai" class="ui button" style="width: 30%; margin: 2px 0 2px" onclick="type_pref(this.id)">Thai</div>
                      <div id="Indian" class="ui button" style="width: 30%; margin: 2px 0 2px"  onclick="type_pref(this.id)">Indian</div>
                      <div id="Itlian" class="ui button" style="width: 30%; margin: 2px 0 2px"  onclick="type_pref(this.id)">Italian</div>
                    </div>
                    <div id="tab-2" class="tab-content" style="align-content: space-between;">
                      <div id="PulBitMaRu" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">PulBitMaRu</div>
                      <div id="DDDN" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">DDDN</div>
                      <div id="GoSoMi Chicken" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">GoSoMi Chicken</div>
                      <div id="Noodle Tree" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">Noodle Tree</div>
                      <div id="MoriMori" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">MoriMori</div>
                      <div id="Bab&Bulgogi" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">Bab&Bulgogi</div>
                      <div id="Sand Brunch" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">Sand Brunch</div>
                      <div id="KimChiWon" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">KimChiWon</div>
                      <div id="Yoshida" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">Yoshida</div>
                      <div id="111-7" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">111-7</div>
                      <div id="Malgm" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">Malgm</div>
                      <div id="OmaiDong" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">OmaiDong</div>
                      <div id="Do-Me Barbeque" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">Do-Me Barbeque</div>
                      <div id="MatGoeul" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">MatGoeul</div>
                      <div id="So-Do" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">So-Do</div>
                      <div id="Gwang-jang" class="ui button" style="margin: 2px 0 2px" onclick="type_pref(this.id);">Gwang-jang</div>
                    </div>

                    <div id="tab-3" class="tab-content" style="align-content: space-around;">
                      <div class="grid-item time">
                          <form class = "ui form" action = "/action_page.php">
                              <input type = "time" id="apt_time" style="width: auto;">
                              <!-- <input type = "submit"> -->
															<div type="send" class="ui button" onclick="set_time();" style="width: auto;">
																select time
															</div>
                          </form>
                      </div>
                    </div>
                 </div>
                </div>

           <!-- <div class="ui bottom attached segment">
             <p></p>
         </div> -->
         <!-- The core Firebase JS SDK is always required and must be listed first -->
                  <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-app.js"></script>

                  <!-- TODO: Add SDKs for Firebase products that you want to use https://firebase.google.com/docs/web/setup#available-libraries -->
                  <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-auth.js"></script>
                  <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-functions.js"></script>
                  <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-storage.js"></script>
                  <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-database.js"></script>

									<script>
			                 // Your web app's Firebase configuration
			                 var firebaseConfig = {
			                  apiKey: "AIzaSyAD0Y04NLAtEukphcSJ1s6T8Ffp_AWx-ew",
			                  authDomain: "galbi-3ce0c.firebaseapp.com",
			                  databaseURL: "https://galbi-3ce0c.firebaseio.com",
			                  projectId: "galbi-3ce0c",
			                  storageBucket: "galbi-3ce0c.appspot.com",
			                  messagingSenderId: "287266351759",
			                  appId: "1:287266351759:web:3bdf04f7e5202420549efa"
			                };
			                  // Initialize Firebase
			                  firebase.initializeApp(firebaseConfig);
			                  // Get a reference to the database service
			                  var database = firebase.database();
			                  var ChatroomNum = window.location.href.split("?")[1].split("=")[1];
			                  var ChatroomMsg = database.ref('ChatroomMsg/Chatroom' + ChatroomNum);
			                  var ChatroomaPart = database.ref('ChatroomPart/Chatroom' + ChatroomNum);
			                  var chat_part_ref = database.ref("ChatroomPart/Chatroom" + ChatroomNum).on("child_added", function (snapshot) {
			                   var name = snapshot.key;
			                   var owner = snapshot.val();
			                   var nametag = document.getElementsByClassName("text-center")[0];
			                   if (owner == true) {
			                     nametag.innerHTML = name + nametag.innerHTML;
			                   }
			                   else {
			                     nametag.innerHTML = nametag.innerHTML + ', ' + name;
			                   }

			                 });
			                  var me = sessionStorage.getItem("id");
			                  var chat_data_ref = ChatroomMsg.on('child_added', function(snapshot){
			                    var str_snapshot = JSON.stringify(snapshot);
			                    //alert(str_snapshot);
			                    var temp = str_snapshot.split(',')
			                    var chat = temp[0].split(':')[1].replace(/['"{}]+/g, '');
			                    var time = temp[1].split(':')[1].replace(/['"{}]+/g, '');
			                    var user = temp[2].split(':')[1].replace(/['"{}]+/g, '');
			                    if(user == "Dummy"){
			                     console.log("dummy chat pass");
			                    }
			                    else if(user == me){
			                      append_outgoing_msg(chat, time);
			                    }
			                    else{
			                      append_incoming_msg(chat, time);
			                    }
			                    var rootelem = document.getElementsByClassName("msg_history")[0];
			                    rootelem.scrollTop = rootelem.scrollHeight;
			                  });
			                  function goBack(){
			                   location.replace("chats.html");
			                 }
			                 function send_message(){
			                    //var message = document.getElementById("chat").value;
			                    var date = new Date();
			                    var year = date.getFullYear() + "";
			                    var month = (date.getMonth() + 1) + "";
			                    month = (month[1] ? month : '0' + month);
			                    var day = date.getDate() + "";
			                    day = (day[1] ? day : '0' + day);
			                    var hour = date.getHours() + "";
			                    hour = (hour[1] ? hour : '0' + hour);
			                    var minute = date.getMinutes() + "";
			                    minute = (minute[1] ? minute : '0' + minute);
			                    var second = date.getSeconds() + "";
			                    second = (second[1] ? second : '0' + second);
			                    var ms = date.getMilliseconds() + "";
			                    var timeid = year + month + day + hour + minute + second + ms;
			                    var msg = document.getElementById("type_here").getAttribute("value");
			                    var usr = sessionStorage.getItem("id");
			                    database.ref().child('ChatroomMsg/Chatroom' + ChatroomNum +'/Chat' + timeid).set({
			                      User : usr,
			                      Content : msg,
			                      Time : year+'.' + month+'.' + day+'.' + hour+'.' + minute+'.' + second
			                    });
			                  }
			                  function append_outgoing_msg(chat, time){
			                    var rootelem = document.getElementsByClassName("msg_history")[0];
			                    var outgoelem = document.createElement("div");
			                    outgoelem.setAttribute('class', 'outgoing_msg');
			                    var msgelem = document.createElement("div");
			                    msgelem.setAttribute('class', "sent_msg");
			                    var msg = document.createElement('p');
			                    msg.innerHTML = chat;
			                    var tim = document.createElement("span");
			                    tim.setAttribute('class', "time_date");
			                    tim.innerHTML = time;
			                    msgelem.appendChild(msg);
			                    msgelem.appendChild(tim);
			                    outgoelem.appendChild(msgelem);
			                    rootelem.appendChild(outgoelem);
			                  }
			                  function append_incoming_msg(chat, time){
			                    var rootelem = document.getElementsByClassName("msg_history")[0];
			                    var incomeelem = document.createElement("div");
			                    incomeelem.setAttribute('class', 'incoming_msg');
			                    var imgelem = document.createElement("div");
			                    imgelem.setAttribute('class', 'incoming_msg_img');
			                    var img = document.createElement("img");
			                    img.setAttribute('src', "../images/chani.jpg");
			                    // img.setAttribute('alt', "sunil");
			                    var msgelem = document.createElement("div");
			                    msgelem.setAttribute('class', "received_msg");
			                    var msg = document.createElement('p');
			                    msg.innerHTML = chat;
			                    var tim = document.createElement("span");
			                    tim.setAttribute('class', "time_date");
			                    tim.innerHTML = time;
			                    imgelem.appendChild(img);
			                    msgelem.appendChild(msg);
			                    msgelem.appendChild(tim);
			                    incomeelem.appendChild(imgelem);
			                    incomeelem.appendChild(msgelem);
			                    rootelem.appendChild(incomeelem);
			                  }
			                  function type_pref(abc){
			                    text = document.getElementById("type_here").getAttribute("value");
			                    if (["Good", "Bad", "Yes", "No", "?", "."].includes(abc)){
			                      text = text + abc;
			                    }
			                    else{
			                      text = text + '/' + abc;
			                    }
			                    if (text[0]=='/'){
			                      text = text.slice(1,);
			                    }
			                    document.getElementById("type_here").setAttribute("value", text);
			                  }
			                  function untype_pref(){
			                   var text = document.getElementById("type_here").getAttribute("value");
			                   var len = text.length;
			 									 // alert(text.charAt(len-1));
			 									 if (["Good", "Bad", "Yes", "No", "?", "."].includes(text.charAt(len-1))){
			                    text = text.substring(0, len-1);
			 										 // alert(text);
			                     }
			                     else{
			                      var lastidx = text.lastIndexOf('/');
			                      text = text.substring(0, lastidx);
			                    }
			                    document.getElementById("type_here").setAttribute("value", text);
			                  }
			                  function send_message(){
			                    var rootelem = document.getElementsByClassName("msg_history")[0];
			                    var outgoelem = document.createElement("div");
			                    outgoelem.setAttribute('class', 'outgoing_msg');
			                    var msgelem = document.createElement("div");
			                    msgelem.setAttribute('class', "sent_msg");
			                    var msg = document.createElement('p');
			                    var text_msg = document.getElementById("type_here").getAttribute("value");
			                    msg.innerHTML = text_msg;
			                    var time = document.createElement("span");
			                    time.setAttribute('class', "time_date");
			                    time.innerHTML = "Time and date will be added!!!!!";
			                    msgelem.appendChild(msg);
			                    msgelem.appendChild(time);
			                    outgoelem.appendChild(msgelem);
			                    rootelem.appendChild(outgoelem);
			                    document.getElementById("type_here").setAttribute("value", "")
			                  }
			                  function set_time(){
			                   var time_val = document.getElementById("apt_time").value;
			 									 // alert(time_val);
			 									 type_pref(time_val);
			 									 // document.getElementById("type_here").setAttribute("value", time_val);
			                  }
			                </script>

         <script>
         	$(document).ready(function(){
         		$('ul.tabs li').click(function(){
         			var tab_id = $(this).attr('data-tab');
         			$('ul.tabs li').removeClass('current');
         			$('.tab-content').removeClass('current');
         			$(this).addClass('current');
         			$("#"+tab_id).addClass('current');
         		})
         	})
         </script>
     </div>

 </body>
 </html>
